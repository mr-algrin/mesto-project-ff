(()=>{"use strict";var e=document.querySelector("#card-template"),t=document.querySelector(".places__list"),n=document.querySelector(".profile__title"),o=document.querySelector(".profile__description"),r=document.querySelector(".profile__image"),c=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__edit-button"),a=document.querySelector(".popup_type_edit"),u=document.querySelector(".popup_type_new-card"),l=document.querySelector(".popup_type_image"),s=document.querySelector(".popup_type_update-avatar"),d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"b7626373-9d6a-49f5-8ea3-25c2d7a22671","Content-Type":"application/json"}},p=function(e){return d.baseUrl+e},f=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}var v=e.content,_=function(e){return e.dataset.id},h=function(e,t,n,o,r){if("object"===m(e)&&void 0!==e.name&&void 0!==e.link){var c=v.cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__delete-button");c.querySelector(".card__title").textContent=e.name;var u=c.querySelector(".card");u&&(u.dataset.id=e._id),null!==i&&(i.src=e.link,i.alt="Изображение ".concat(e.name),i.addEventListener("click",r)),null!==a&&(a.addEventListener("click",n),e.owner._id!==t&&a.classList.add("card__delete-button_disabled")),c.querySelector(".card__like-button").addEventListener("click",o);var l,s,d=(l=e.likes,s=t,l.some((function(e){return e._id===s}))),p=c.querySelector(".card__like-button");return d?p.classList.add("card__like-button_is-active"):p.classList.remove("card__like-button_is-active"),y(c,e.likes.length),c}},y=function(e,t){e.querySelector(".card__like-counter").textContent=t},S=function(e){if(e.target){e.stopPropagation();var t=e.target.closest(".card"),n=_(t);e.target.classList.contains("card__like-button_is-active")?function(e){return fetch(p("/cards/likes/".concat(e)),{method:"DELETE",headers:d.headers}).then(f)}(n).then((function(n){y(t,n.likes.length),e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)})):function(e){return fetch(p("/cards/likes/".concat(e)),{method:"PUT",headers:d.headers}).then(f)}(n).then((function(n){y(t,n.likes.length),e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}},b=function(e){if(e.target){e.stopPropagation();var t=e.target.closest(".card"),n=_(t);n&&function(e){return fetch(p("/cards/".concat(e)),{headers:d.headers,method:"DELETE"}).then(f)}(n).then((function(){null==t||t.remove()})).catch((function(e){return console.log(e)}))}},g=void 0,k=function(e){return e.querySelector(".popup__close")},q=function(e){e.preventDefault(),e.stopPropagation(),x(g)},E=function(e){e.target.classList.contains("popup")&&x(g)},L=function(e){"Escape"===e.key&&x(g)},C=function(e){if(e){g=e,e.classList.add("popup_is-opened","popup_is-animated"),e.addEventListener("click",E),document.addEventListener("keydown",L);var t=k(e);null==t||t.addEventListener("click",q)}},x=function(e){if(e){e.classList.remove("popup_is-opened","popup_is-animated");var t=k(e);null==t||t.removeEventListener("click",q),document.removeEventListener("keydown",L),e.removeEventListener("click",E),g=void 0}},P=document.forms["update-avatar"],A=document.forms["edit-profile"],B=document.forms["new-place"],T=A.elements.name,j=A.elements.description,w=B.elements["place-name"],D=B.elements.link,O=P.elements.url,N="Сохранить",J="Сохранение...",M=function(e,t){var n=e.querySelector(".popup__button");null!==n&&(n.textContent=t)},U=function(){O&&(O.value="")},H=function(){w&&(w.value=""),D&&(D.value="")},z=[],V={name:"",about:"",avatar:"",_id:"",cohort:""},F=function(e){Object.keys(V).forEach((function(t){t in e&&(V[t]=e[t])}))},G=function(){var e=V.about,t=V.name,c=V.avatar;t&&n&&(n.textContent=t),e&&o&&(o.textContent=e),c&&r&&(r.style["background-image"]="url(".concat(c,")"))},I=function(e,t){e.querySelector(".".concat(t.id,"-error")).textContent=""},K=function(e,t){t.formSelector;var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=(t.inputErrorClass,t.errorClass,Array.from(e.querySelectorAll(n)));e.querySelector(o).classList.add(r),c.forEach((function(t){return I(e,t)}))},Q=function(e,t,n){var o=function(e){return e.some((function(e){return!e.validity.valid}))}(e);t.disabled=o,o?t.classList.add(n.inactiveButtonClass):t.classList.remove(n.inactiveButtonClass)},R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"};r&&r.addEventListener("click",(function(){K(P,R),U(),M(P,N),C(s)})),i&&i.addEventListener("click",(function(){var e;!function(e){var t=e.title,n=e.description;T&&(T.value=t||""),j&&(j.value=n||"")}((e={title:"",description:""},n&&(e.title=n.textContent),o&&(e.description=o.textContent),e)),K(A,R),M(A,N),C(a)})),null!==c&&c.addEventListener("click",(function(){H(),K(B,R),M(B,N),C(u)})),P&&P.addEventListener("submit",(function(e){e.preventDefault();var t,n=O?O.value:"";M(P,J),(t=n,fetch(p("/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then(f)).then((function(e){F(e),G(),x(s),U()})).catch((function(e){return console.log(e)}))})),A&&A.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=function(){var e={title:"",description:""};return T&&(e.title=T.value),j&&(e.description=j.value),e}();M(A,J),(t=o.title,n=o.description,fetch(p("/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:n})}).then(f)).then((function(e){F(e),G(),x(a)})).catch((function(e){return console.log(e)}))})),B&&B.addEventListener("submit",(function(e){e.preventDefault();var n,o,r,c=(n={name:"",link:""},w&&(n.name=w.value),D&&(n.link=D.value),n);M(B,J),(o=c.name,r=c.link,"string"!=typeof o||"string"!=typeof r?Promise.reject("Ошибка: невалидное значение"):fetch(p("/cards"),{headers:d.headers,method:"POST",body:JSON.stringify({name:o,link:r})}).then(f)).then((function(e){H(),x(u),function(e){z.unshift(e)}(e);var n=h(e,V._id,b,S,W);t&&t.prepend(n)})).catch((function(e){return console.log(e)}))}));var W=function(e){e.target&&(e.stopPropagation(),function(e){var t=document.querySelector(".popup__image");t&&(t.src=e.link,t.alt="Изображение ".concat(e.name));var n=document.querySelector(".popup__caption");n&&(n.textContent=e.name)}(function(e){var t={name:"",link:""};if(e){var n=e.querySelector(".card__title");n&&(t.name=n.textContent);var o=e.querySelector(".card__image");o&&(t.link=o.src)}return t}(e.target.closest(".card"))),C(l))};Promise.all([fetch(p("/users/me"),{headers:d.headers}).then(f),fetch(p("/cards"),{headers:d.headers}).then(f)]).then((function(e){var n;F(e[0]),n=e[1],z.splice(0,z.length),n.forEach((function(e){return z.push(e)})),z.forEach((function(e){var n=h(e,V._id,b,S,W);void 0!==n&&t.append(n)})),G()})).catch((function(e){return console.log(e)})),function(e){var t=e.formSelector,n=e.inputSelector,o=e.submitButtonSelector;Array.from(document.querySelectorAll(t)).forEach((function(t){var r=t.querySelector(o),c=Array.from(t.querySelectorAll(n));Q(c,r,e),c.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.setCustomValidity(t.validity.patternMismatch?t.dataset.errorMessage:""),t.validity.valid?I(e,t):function(e,t,n){e.querySelector(".".concat(t.id,"-error")).textContent=n}(e,t,t.validationMessage)}(t,n),Q(c,r,e)}))}))}))}(R)})();