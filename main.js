(()=>{"use strict";var e=document.querySelector("#card-template"),t=document.querySelector(".places__list"),n=document.querySelector(".profile__title"),o=document.querySelector(".profile__description"),r=document.querySelector(".profile__image"),c=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__edit-button"),a=document.querySelector(".popup_type_edit"),u=document.querySelector(".popup_type_new-card"),s=document.querySelector(".popup_type_image"),l=document.querySelector(".popup_type_update-avatar"),d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"b7626373-9d6a-49f5-8ea3-25c2d7a22671","Content-Type":"application/json"}},f=function(e){return d.baseUrl+e};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}var m=e.content,v=function(e){return e.dataset.id},_=function(e,t,n,o,r){if("object"===p(e)&&void 0!==e.name&&void 0!==e.link){var c=m.cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__delete-button");c.querySelector(".card__title").textContent=e.name;var u=c.querySelector(".card");u&&(u.dataset.id=e._id),null!==i&&(i.src=e.link,i.alt="Изображение ".concat(e.name),i.addEventListener("click",r)),null!==a&&(a.addEventListener("click",n),e.owner._id!==t&&a.classList.add("card__delete-button_disabled")),c.querySelector(".card__like-button").addEventListener("click",o);var s,l,d=(s=e.likes,l=t,s.some((function(e){return e._id===l}))),f=c.querySelector(".card__like-button");return d?f.classList.add("card__like-button_is-active"):f.classList.remove("card__like-button_is-active"),h(c,e.likes.length),c}},h=function(e,t){e.querySelector(".card__like-counter").textContent=t},y=function(e){if(e.target){e.stopPropagation();var t=e.target.closest(".card"),n=v(t);e.target.classList.contains("card__like-button_is-active")?function(e){return fetch(f("/cards/likes/".concat(e)),{method:"DELETE",headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(n){h(t,n.likes.length),e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)})):function(e){return fetch(f("/cards/likes/".concat(e)),{method:"PUT",headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(n){h(t,n.likes.length),e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}},S=function(e){if(e.target){e.stopPropagation();var t=e.target.closest(".card"),n=v(t);n&&function(e){return fetch(f("/cards/".concat(e)),{headers:d.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(){null==t||t.remove()})).catch((function(e){return console.log(e)}))}},g=void 0,k=function(e){return e.querySelector(".popup__close")},b=function(e){e.preventDefault(),e.stopPropagation(),C(g)},q=function(e){e.target.classList.contains("popup")&&C(g)},E=function(e){"Escape"===e.key&&C(g)},L=function(e){if(e){g=e,e.classList.add("popup_is-opened","popup_is-animated"),e.addEventListener("click",q),document.addEventListener("keydown",E);var t=k(e);null==t||t.addEventListener("click",b)}},C=function(e){if(e){e.classList.remove("popup_is-opened","popup_is-animated");var t=k(e);null==t||t.removeEventListener("click",b),document.removeEventListener("keydown",E),e.removeEventListener("click",q),g=void 0}},j=document.forms["update-avatar"],P=document.forms["edit-profile"],x=document.forms["new-place"],A=P.elements.name,B=P.elements.description,T=x.elements["place-name"],w=x.elements.link,D=j.elements.url,O="Сохранить",N="Сохранение...",J=function(e,t){var n=e.querySelector(".popup__button");null!==n&&(n.textContent=t)},M=function(){T&&(T.value=""),w&&(w.value="")},U=[],H={name:"",about:"",avatar:"",_id:"",cohort:""},z=function(e){Object.keys(H).forEach((function(t){t in e&&(H[t]=e[t])}))},V=function(){var e=H.about,t=H.name,c=H.avatar;t&&n&&(n.textContent=t),e&&o&&(o.textContent=e),c&&r&&(r.style["background-image"]="url(".concat(c,")"))},F=function(e,t){t.formSelector,t.inputSelector;var n=t.submitButtonSelector,o=t.inactiveButtonClass,r=t.inputErrorClass,c=(t.errorClass,Array.from(e.querySelectorAll(".".concat(r))));e.querySelector(n).classList.add(o),c.forEach((function(e){e.textContent=""}))},G=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)},I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"};r&&r.addEventListener("click",(function(){F(j,I),J(j,O),L(l)})),i&&i.addEventListener("click",(function(){var e;!function(e){var t=e.title,n=e.description;A&&(A.value=t||""),B&&(B.value=n||"")}((e={title:"",description:""},n&&(e.title=n.textContent),o&&(e.description=o.textContent),e)),F(P,I),J(P,O),L(a)})),null!==c&&c.addEventListener("click",(function(){M(),F(x,I),J(x,O),L(u)})),j&&j.addEventListener("submit",(function(e){e.preventDefault();var t,n=D?D.value:"";J(j,N),(t=n,fetch(f("/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){z(e),V()})).catch((function(e){return console.log(e)})).finally((function(){D&&(D.value=""),C(l)}))})),P&&P.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=function(){var e={title:"",description:""};return A&&(e.title=A.value),B&&(e.description=B.value),e}();J(P,N),(t=o.title,n=o.description,fetch(f("/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){z(e),V()})).catch((function(e){return console.log(e)})).finally((function(){return C(a)}))})),x&&x.addEventListener("submit",(function(e){e.preventDefault();var n,o,r,c=(n={name:"",link:""},T&&(n.name=T.value),w&&(n.link=w.value),n);J(x,N),(o=c.name,r=c.link,"string"!=typeof o||"string"!=typeof r?Promise.reject("Ошибка: невалидное значение"):fetch(f("/cards"),{headers:d.headers,method:"POST",body:JSON.stringify({name:o,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){!function(e){console.log("before insert:",U.length),U.unshift(e),console.log("after insert:",U.length)}(e);var n=_(e,H._id,S,y,K);t&&t.prepend(n)})).catch((function(e){return console.log(e)})).finally((function(){M(),C(u)}))}));var K=function(e){e.target&&(e.stopPropagation(),function(e){var t=document.querySelector(".popup__image");t&&(t.src=e.link,t.alt="Изображение ".concat(e.name));var n=document.querySelector(".popup__caption");n&&(n.textContent=e.name)}(function(e){var t={name:"",link:""};if(e){var n=e.querySelector(".card__title");n&&(t.name=n.textContent);var o=e.querySelector(".card__image");o&&(t.link=o.src)}return t}(e.target.closest(".card"))),L(s))};Promise.all([fetch(f("/users/me"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch(f("/cards"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var n;z(e[0]),n=e[1],U.splice(0,U.length),n.forEach((function(e){return U.push(e)})),U.forEach((function(e){var n=_(e,H._id,S,y,K);void 0!==n&&t.append(n)})),V()})).catch((function(e){return console.log(e)})),function(e){var t=e.formSelector,n=e.inputSelector,o=e.submitButtonSelector;Array.from(document.querySelectorAll(t)).forEach((function(t){var r=t.querySelector(o),c=Array.from(t.querySelectorAll(n));G(c,r,e),c.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.setCustomValidity(t.validity.patternMismatch?t.dataset.errorMessage:""),t.validity.valid?function(e,t){e.querySelector(".".concat(t.id,"-error")).textContent=""}(e,t):function(e,t,n){e.querySelector(".".concat(t.id,"-error")).textContent=n}(e,t,t.validationMessage)}(t,n),G(c,r,e)}))}))}))}(I)})();